from flask import Blueprint
from flask import current_app as app
from flask import request

player_blueprint = Blueprint('player', __name__)


# this route is about interacting with other players. sending resource cards to another player, stealing a resource
# card from another player, or playing a dev card

@player_blueprint.route('/player')
def index():
    return {
        "msg": "player here",
        "request method": request.method,
        # "players": [app.game.players[player_name].to_private_json() for player_name in app.game.players]
    }


'''
input is expected to be in this format
{
  "playerFrom": "player_from_name",
  "playerTo": "player_to_name",
  "resources": {
    "Wheat": 1,
    "Ore": 0,
    "Wood": 0,
    "Sheep": 0,
    "Brick": 0
  }
}
'''


@player_blueprint.route('/player/sendCardsToPlayer', methods=['POST'])
def send_cards():
    req_data = request.get_json(force=True)

    player_from = app.game.get_player(req_data["playerFrom"])
    player_to = app.game.get_player(req_data["playerTo"])
    player_from.send_cards_to_player(player_to, req_data["resources"])

    return '', 204


'''
input is expected to be in this format
{
  "thief": "thief_player_name",
  "victim": "victim_player_name"
}
'''


@player_blueprint.route('/player/stealFromPlayer', methods=['POST'])
def steal_card():
    req_data = request.get_json(force=True)

    thief = app.game.get_player(req_data["thief"])
    victim = app.game.get_player(req_data["victim"])
    thief.steal_random_from_player(victim)

    return '', 204


'''
Expected to have two query params
player = player_name
devCard = dev_card to play
'''


@player_blueprint.route('/player/playDevCard', methods=['PUT'])
def play_dev_card():
    player_name = request.args.get("player")
    dev_card = request.args.get("devCard")

    player = app.game.get_player(player_name)
    player.play_dev_card(dev_card)

    return '', 204


@player_blueprint.route('/player/updateAward', methods=['PUT'])
def update_award():
    player_name = request.args.get("player")
    award = request.args.get("award")

    for player in app.game.players.values():
        if award in player.awards:
            player.awards.remove(award)

    app.game.get_player(player_name).awards.add(award)
    return '', 204


@player_blueprint.route('/player/updateAward', methods=['DELETE'])
def delete_award():
    player_name = request.args.get("player")
    award = request.args.get("award")

    if award in app.game.get_player(player_name).awards:
        app.game.get_player(player_name).awards.remove(award)

    return '', 204
